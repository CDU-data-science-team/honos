names_sep = "_") %>%
mutate(item = factor(str_extract(item, "\\d+"),
labels = 1:13),
value = as.numeric(value)) %>%
# replace 9 (Not known) with NA
pivot_wider(names_from = lag,
values_from = value) %>%
mutate(honos_change = lag1honos - honos,
honos_date_daysdiff = difftime(date, lag1date,
units = c("days")))
honos_wide %>%
group_by(id) %>%
arrange(id, date) %>%
mutate(across(.cols = all_of(c("date", {{ honos_scales_new_names }})),
.fns = list(lag1 = ~lag(.)),
.names = "{fn}{col}")) %>%
ungroup() %>%
pivot_longer(cols = all_of(c({{ honos_scales_new_names }}, {{ honos_scales_lag_names }})),
values_to = "value",
names_to = c("lag", "item"),
names_sep = "_") %>%
mutate(item = factor(str_extract(item, "\\d+"),
labels = 1:13),
value = as.numeric(value)) %>%
# replace 9 (Not known) with NA
pivot_wider(names_from = lag,
values_from = value) %>%
mutate(honos_change = lag1honos - honos,
honos_date_daysdiff = difftime(date, lag1date,
units = c("days"))) %>%
drop_na(honos_date_daysdiff)
honos_wide %>%
select(-measure) %>%
group_by(id) %>%
arrange(id, date) %>%
mutate(across(.cols = all_of(c("date", {{ honos_scales_new_names }})),
.fns = list(lag1 = ~lag(.)),
.names = "{fn}{col}")) %>%
ungroup() %>%
pivot_longer(cols = all_of(c({{ honos_scales_new_names }}, {{ honos_scales_lag_names }})),
values_to = "value",
names_to = c("lag", "item"),
names_sep = "_") %>%
mutate(item = factor(str_extract(item, "\\d+"),
labels = 1:13),
value = as.numeric(value)) %>%
# replace 9 (Not known) with NA
pivot_wider(names_from = lag,
values_from = value) %>%
mutate(honos_change = lag1honos - honos,
honos_date_daysdiff = difftime(date, lag1date,
units = c("days"))) %>%
drop_na(honos_date_daysdiff)
.10
.1
lag_honos <- function(data, id_var, date_var) {
honos_scales_new_names <- paste0("honos_i", 1:13)
honos_scales_lag_names <- paste0("lag1", "honos", "_", "i", 1:13)
data %>%
dplyr::group_by({{ id_var }}) %>%
arrange({{ id_var }}, {{ date_var }}) %>%
mutate(across(.cols = dplyr::all_of(c({{ date_var }}, {{ honos_scales_new_names }})),
.fns = list(lag1 = ~dplyr::lag(.)),
.names = "{fn}{col}")) %>%
ungroup() %>%
tidyr::pivot_longer(cols = dplyr::all_of(c({{ honos_scales_new_names }}, {{ honos_scales_lag_names }})),
values_to = "value",
names_to = c("lag", "item"),
names_sep = "_") %>%
mutate(item = factor(str_extract(item, "\\d+"),
labels = 1:13),
value = as.numeric(value)) %>%
# replace 9 (Not known) with NA
tidyr::pivot_wider(names_from = lag,
values_from = value) %>%
dplyr::mutate(honos_change = lag1honos - honos,
honos_date_daysdiff = difftime(date, lag1date,
units = c("days"))) %>%
tidyr::drop_na(honos_date_daysdiff)
}
??difftime
lag_honos <- function(data, id_var, date_var) {
honos_scales_new_names <- paste0("honos_i", 1:13)
honos_scales_lag_names <- paste0("lag1", "honos", "_", "i", 1:13)
data %>%
dplyr::group_by({{ id_var }}) %>%
dplyr::arrange({{ id_var }}, {{ date_var }}) %>%
dplyr::mutate(across(.cols = dplyr::all_of(c({{ date_var }}, {{ honos_scales_new_names }})),
.fns = list(lag1 = ~dplyr::lag(.)),
.names = "{fn}{col}")) %>%
ungroup() %>%
tidyr::pivot_longer(cols = dplyr::all_of(c({{ honos_scales_new_names }}, {{ honos_scales_lag_names }})),
values_to = "value",
names_to = c("lag", "item"),
names_sep = "_") %>%
dplyr::mutate(item = factor(str_extract(item, "\\d+"),
labels = 1:13),
value = as.numeric(value)) %>%
# replace 9 (Not known) with NA
tidyr::pivot_wider(names_from = lag,
values_from = value) %>%
dplyr::mutate(honos_change = lag1honos - honos,
honos_date_daysdiff = difftime(date, lag1date,
units = c("days"))) %>%
tidyr::drop_na(honos_date_daysdiff)
}
library(honos)
library(honos)
stringr::str
honos_wide
honos_wide %>%
honos::lag_honos()
honos_wide %>%
honos::lag_honos(id_var = id, date_var = date)
library(honos)
honos_wide %>%
honos::lag_honos(id_var = id, date_var = date)
library(honos)
honos_wide %>%
honos::lag_honos(id_var = id, date_var = date)
honos_wide %>%
honos::lag_honos(id_var = id, date_var = date)
library(honos)
honos_wide %>%
honos::lag_honos(id_var = id, date_var = date)
honos_wide
library(honos)
honos_wide %>%
honos::lag_honos(id_var = id, date_var = date)
library(honos)
honos_wide %>%
honos::lag_honos(id_var = id, date_var = date)
honos_wide %>%
honos::lag_honos(id_var = id, date_var = date)
library(honos)
honos_wide %>%
honos::lag_honos(id_var = id, date_var = date)
library(honos)
library(honos)
honos_wide %>%
honos::lag_honos(id_var = id, date_var = date)
library(honos)
honos_wide %>%
honos::lag_honos(id_var = id, date_var = date)
library(honos)
honos_wide %>%
honos::lag_honos(id_var = id, date_var = date)
library(honos)
honos_wide %>%
honos::lag_honos(id_var = id, date_var = date)
library(honos)
honos_wide %>%
honos::lag_honos(id_var = id, date_var = date)
arsch <- function(lala) {
paste("as", lala)
}
arsch(lala = lala)
arsch(lala = "lala")
arsch <- function(lala) {
paste0("as", lala)
}
arsch(lala = "lala")
arsch(lala = a)
arsch <- function(lala) {
paste0("as", {{lala}})
}
arsch(lala = a)
arsch <- function(lala) {
# paste0("as", {{lala}})
!! rlang::sym(lala)
}
arsch(lala = a)
arsch <- function(lala) {
# paste0("as", {{lala}})
!! rlang::sym({{lala}})
}
arsch(lala = a)
arsch <- function(lala) {
# paste0("as", {{lala}})
rlang::sym({{lala}})
}
arsch(lala = a)
arsch <- function(lala) {
# paste0("as", {{lala}})
ensym(lala)
}
arsch(lala = a)
arsch <- function(lala) {
# paste0("as", {{lala}})
rlang::ensym(lala)
}
arsch(lala = a)
arsch <- function(lala) {
# paste0("as", {{lala}})
paste0("lag1",rlang::ensym(lala))
}
arsch(lala = a)
arsch <- function(lala) {
# paste0("as", {{lala}})
rlang::sym(paste0("lag1",rlang::ensym(lala)))
}
arsch(lala = a)
library(honos)
honos_wide %>%
honos::lag_honos(id_var = id, date_var = date)
library(honos)
honos_wide %>%
honos::lag_honos(id_var = id, date_var = date)
library(honos)
honos_wide %>%
honos::lag_honos(id_var = id, date_var = date)
honos_wide %>%
rename(id = id2)
honos_wide %>%
rename(client_id = id)
honos::lag_honos(id_var = client_id, date_var = date)
honos_wide %>%
rename(client_id = id) %>%
honos::lag_honos(id_var = client_id, date_var = date)
honos_wide %>%
rename(client_id = id, assessment_date = date) %>%
honos::lag_honos(id_var = client_id, date_var = date)
honos_wide %>%
rename(client_id = id, assessment_date = date) %>%
honos::lag_honos(id_var = client_id, date_var = assessment_date)
as_change_labels <- function(value, lag_value) {
case_when({{value}} %in% c(3:4) & {{lag_value}} %in% c(0:2) ~ "HL",
{{value}} %in% c(0:2) & {{lag_value}} %in% c(3:4) ~ "LH",
{{value}} %in% c(0:2) & {{lag_value}} %in% c(0:2) ~ "LL",
{{value}} %in% c(3:4) & {{lag_value}} %in% c(3:4) ~ "HH")
}
as_change_labels(0, 4)
as_change_labels <- function(value, lag_value, return = c("high_low", "deterio_impove")) {
return <- match.arg(return)
# Define high low change categories
x4 <- case_when({{value}} %in% c(3:4) & {{lag_value}} %in% c(0:2) ~ "HL",
{{value}} %in% c(0:2) & {{lag_value}} %in% c(3:4) ~ "LH",
{{value}} %in% c(0:2) & {{lag_value}} %in% c(0:2) ~ "LL",
{{value}} %in% c(3:4) & {{lag_value}} %in% c(3:4) ~ "HH")
# Create factor
x4 <-  factor(x, levels = c("LL", "LH", "HL", "HH"))
if (return == "high_low") {
return(x4)
} else if (return == "deterio_impove") {
x3 <- case_when(x %in% c("LL", "HH") ~ "Unchanged",
x == "LH" ~ "Deterioation",
x == "HL" ~ "Improvement")
x3 <- factor(x3,
levels = c("Deterioation", "Unchanged", "Improvement"))
return(x3)
}
}
as_change_labels(0, 4)
as_change_labels <- function(value, lag_value, return = c("high_low", "deterio_impove")) {
return <- match.arg(return)
# Define high low change categories
x4 <- case_when({{value}} %in% c(3:4) & {{lag_value}} %in% c(0:2) ~ "HL",
{{value}} %in% c(0:2) & {{lag_value}} %in% c(3:4) ~ "LH",
{{value}} %in% c(0:2) & {{lag_value}} %in% c(0:2) ~ "LL",
{{value}} %in% c(3:4) & {{lag_value}} %in% c(3:4) ~ "HH")
# Create factor
x4 <-  factor(x, levels = c("LL", "LH", "HL", "HH"))
if (return == "high_low") {
return(x4)
} else if (return == "deterio_impove") {
x3 <- case_when(x4 %in% c("LL", "HH") ~ "Unchanged",
x4 == "LH" ~ "Deterioation",
x4 == "HL" ~ "Improvement")
x3 <- factor(x3,
levels = c("Deterioation", "Unchanged", "Improvement"))
return(x3)
}
}
as_change_labels(0, 4)
as_change_labels <- function(value, lag_value, return = c("high_low", "deterio_impove")) {
return <- match.arg(return)
# Define high low change categories
x4 <- case_when({{value}} %in% c(3:4) & {{lag_value}} %in% c(0:2) ~ "HL",
{{value}} %in% c(0:2) & {{lag_value}} %in% c(3:4) ~ "LH",
{{value}} %in% c(0:2) & {{lag_value}} %in% c(0:2) ~ "LL",
{{value}} %in% c(3:4) & {{lag_value}} %in% c(3:4) ~ "HH")
# Create factor
x4 <-  factor(x4, levels = c("LL", "LH", "HL", "HH"))
if (return == "high_low") {
return(x4)
} else if (return == "deterio_impove") {
x3 <- case_when(x4 %in% c("LL", "HH") ~ "Unchanged",
x4 == "LH" ~ "Deterioation",
x4 == "HL" ~ "Improvement")
x3 <- factor(x3,
levels = c("Deterioation", "Unchanged", "Improvement"))
return(x3)
}
}
as_change_labels(0, 4)
as_change_labels(0, 4, return = "deterio_improve")
as_change_labels <- function(value, lag_value, return = c("high_low", "deterio_improve")) {
return <- match.arg(return)
# Define high low change categories
x4 <- case_when({{value}} %in% c(3:4) & {{lag_value}} %in% c(0:2) ~ "HL",
{{value}} %in% c(0:2) & {{lag_value}} %in% c(3:4) ~ "LH",
{{value}} %in% c(0:2) & {{lag_value}} %in% c(0:2) ~ "LL",
{{value}} %in% c(3:4) & {{lag_value}} %in% c(3:4) ~ "HH")
# Create factor
x4 <-  factor(x4, levels = c("LL", "LH", "HL", "HH"))
if (return == "high_low") {
return(x4)
} else if (return == "deterio_impove") {
x3 <- case_when(x4 %in% c("LL", "HH") ~ "Unchanged",
x4 == "LH" ~ "Deterioation",
x4 == "HL" ~ "Improvement")
x3 <- factor(x3,
levels = c("Deterioation", "Unchanged", "Improvement"))
return(x3)
}
}
as_change_labels(0, 4, return = "deterio_improve")
as_change_labels <- function(value, lag_value, return = c("high_low", "deterio_improve")) {
return <- match.arg(return)
# Define high low change categories
x4 <- case_when({{value}} %in% c(3:4) & {{lag_value}} %in% c(0:2) ~ "HL",
{{value}} %in% c(0:2) & {{lag_value}} %in% c(3:4) ~ "LH",
{{value}} %in% c(0:2) & {{lag_value}} %in% c(0:2) ~ "LL",
{{value}} %in% c(3:4) & {{lag_value}} %in% c(3:4) ~ "HH")
# Create factor
x4 <-  factor(x4, levels = c("LL", "LH", "HL", "HH"))
if (return == "high_low") {
return(x4)
} else if (return == "deterio_improve") {
x3 <- case_when(x4 %in% c("LL", "HH") ~ "Unchanged",
x4 == "LH" ~ "Deterioation",
x4 == "HL" ~ "Improvement")
x3 <- factor(x3,
levels = c("Deterioation", "Unchanged", "Improvement"))
return(x3)
}
}
as_change_labels(0, 4, return = "deterio_improve")
as_change_labels <- function(value, lag_value, return = c("high_low", "deterio_improve")) {
return <- match.arg(return)
# Define high low change categories
x4 <- dplyr::case_when({{value}} %in% c(3:4) & {{lag_value}} %in% c(0:2) ~ "HL",
{{value}} %in% c(0:2) & {{lag_value}} %in% c(3:4) ~ "LH",
{{value}} %in% c(0:2) & {{lag_value}} %in% c(0:2) ~ "LL",
{{value}} %in% c(3:4) & {{lag_value}} %in% c(3:4) ~ "HH")
# Create factor
x4 <-  factor(x4, levels = c("LL", "LH", "HL", "HH"))
if (return == "high_low") {
return(x4)
} else if (return == "deterio_improve") {
x3 <- dplyr::case_when(x4 %in% c("LL", "HH") ~ "Unchanged",
x4 == "LH" ~ "Deterioation",
x4 == "HL" ~ "Improvement")
x3 <- factor(x3,
levels = c("Deterioation", "Unchanged", "Improvement"))
return(x3)
}
}
as_change_labels(0, 4, return = "deterio_improve")
library(honos)
library(honos)
honos_wide %>%
rename(client_id = id, assessment_date = date) %>%
honos::lag_honos(id_var = client_id, date_var = assessment_date)
honos_wide %>%
rename(client_id = id, assessment_date = date) %>%
honos::lag_honos(id_var = client_id, date_var = assessment_date) %>%
mutate(honos_change_label = honos::as_change_labels(value = honos, lag_value = lag1honos))
library(honos)
library(honos)
honos_long %>%
dplyr::filter(id %in% paste0("id", 1:5))
honos_wide %>%
dplyr::filter(id %in% paste0("id", 1:5))
honos_wide %>%
rename(client_id = id, assessment_date = date) %>%
honos::lag_honos(id_var = client_id, date_var = assessment_date) %>%
mutate(honos_change_label = honos::as_change_labels(value = honos, lag_value = lag1honos))
honos_wide %>%
rename(client_id = id, assessment_date = date) %>%
honos::lag_honos(id_var = client_id, date_var = assessment_date)
as_change_labels(0, 4, return = "deterio_improve")
library(honos)
as_change_label(0, 4, return = "deterio_improve")
as_change_label(0, 4, change_label = "deterio_improve")
as_change_label(0, 4, change_label = "deterio_improve")
library(honos)
as_change_label(0, 4, change_label = "deterio_improve")
honos_wide %>%
rename(client_id = id, assessment_date = date) %>%
honos::lag_honos(id_var = client_id, date_var = assessment_date)
library(honos)
library(honos)
honos_wide %>%
rename(client_id = id, assessment_date = date) %>%
honos::lag_honos(id_var = client_id, date_var = assessment_date)
honos_wide %>%
rename(client_id = id, assessment_date = date) %>%
honos::lag_honos(id_var = client_id, date_var = assessment_date, change_label = "deterio_improve")
library(honos)
library(honos)
usethis::use_package("dplyr")
library(honos)
#' Convert HoNOS severity scores to labelled factor
#'
#' @param x Vector of severity rating from 0 to 4
#' @param na_level String, specifying label for missing values.
#'
#' @return
#' @export
#'
#' @examples
#' x <- 0:4
#' as_severity_desc(x)
as_severity_desc <- function(x, na_level = NULL) {
x <- factor(x,
level = c(0:4),
labels = c("No problem",
"Minor problem",
"Mild problem",
"Moderately severe problem",
"Severe to very severe problem")
)
if (is.null(na_level) == FALSE) {
x <- forcats::fct_explicit_na(x, na_level = na_level)
}
return(x)
}
#' Convert HoNOS item numbers to labelled factor
#'
#' @param x Vector of item numbers
#' @param n_items Numeric, specifying maximum number of items
#'
#' @return
#' @export
#'
#' @examples
#' x <- 1:13
#' as_item_desc(x, n_items = 13)
as_item_desc <- function(x, n_items) {
if (n_items == 13) {
x <- factor(x,
levels = c(1:13),
labels = c(
"Item 1: Overactive, aggressive, disruptive or agitated behaviour",
"Item 2: Non-accidental self-injury",B
library(honos)
library(honos)
usethis::use_package("tidyr")
usethis::use_package("rlang")
library(honos)
usethis::use_package("stringr")
library(honos)
honos_wide %>%
rename(client_id = id, assessment_date = date) %>%
honos::lag_honos(id_var = client_id, date_var = assessment_date, change_label = "deterio_improve") %>%
DT::datatable()
honos_long %>%
mutate(item_desc = as_item_desc(item, n_items = 13)) %>%
mutate(value = as_severity_desc(value, na_level = "I AM A MISSING VALUE")) %>%
reactable::reactable()
honos_wide %>%
rename(client_id = id, assessment_date = date) %>%
honos::lag_honos(id_var = client_id, date_var = assessment_date, change_label = "deterio_improve") %>%
reactable::reactable()
honos_wide %>%
rename(client_id = id, assessment_date = date) %>%
honos::lag_honos(id_var = client_id, date_var = assessment_date, change_label = "deterio_improve") %>%
reactable::reactable()
honos_wide %>%
rename(client_id = id, assessment_date = date) %>%
honos::lag_honos(id_var = client_id, date_var = assessment_date, change_label = "deterio_improve")
library(honos)
honos_wide %>%
rename(client_id = id, assessment_date = date) %>%
honos::lag_honos(id_var = client_id, date_var = assessment_date, change_label = "deterio_improve") %>%
dplyr::mutate(honos_date_diff = date(honos_date_diff))
library(honos)
honos_wide %>%
rename(client_id = id, assessment_date = date) %>%
honos::lag_honos(id_var = client_id, date_var = assessment_date, change_label = "deterio_improve") %>%
dplyr::mutate(honos_date_diff = date(honos_date_diff))
honos_wide %>%
rename(client_id = id, assessment_date = date) %>%
honos::lag_honos(id_var = client_id, date_var = assessment_date, change_label = "deterio_improve")
honos_wide %>%
rename(client_id = id, assessment_date = date) %>%
honos::lag_honos(id_var = client_id, date_var = assessment_date, change_label = "deterio_improve") %>%
dplyr::mutate(honos_date_diff = lubridate::as.difftime(honos_date_diff))
honos_wide %>%
rename(client_id = id, assessment_date = date) %>%
honos::lag_honos(id_var = client_id, date_var = assessment_date, change_label = "deterio_improve") %>%
dplyr::mutate(honos_date_diff = lubridate::as.difftime(honos_date_diff)) %>%
reactable::reactable()
honos_wide %>%
rename(client_id = id, assessment_date = date) %>%
honos::lag_honos(id_var = client_id, date_var = assessment_date, change_label = "deterio_improve") %>%
dplyr::mutate(honos_date_diff = as.character(honos_date_diff)) %>%
reactable::reactable()
dplyr::mutate(honos_date_diff = paste(as.character(honos_date_diff), "days") %>%
honos_wide %>%
rename(client_id = id, assessment_date = date) %>%
honos::lag_honos(id_var = client_id, date_var = assessment_date, change_label = "deterio_improve") %>%
dplyr::mutate(honos_date_diff = paste(as.character(honos_date_diff), "days")) %>%
reactable::reactable()
honos_wide %>%
honos_wide %>%
rename(client_id = id, assessment_date = date) %>%
honos::lag_honos(id_var = client_id, date_var = assessment_date, change_label = "deterio_improve") %>%
dplyr::mutate(honos_date_diff = paste(as.character(honos_date_diff), "days")) %>%
reactable::reactable()
install.packages("pagedown")
